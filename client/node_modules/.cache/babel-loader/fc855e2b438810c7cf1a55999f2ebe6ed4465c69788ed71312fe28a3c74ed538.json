{"ast":null,"code":"import React,{useEffect,useRef,useState}from\"react\";import io from\"socket.io-client\";import Peer from\"simple-peer\";import'./Room.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const socket=io.connect(\"https://192.168.29.23:5000\");const GuestRoom=()=>{const[stream,setStream]=useState();const[peers,setPeers]=useState([]);const[name,setName]=useState(\"\");const[roomID,setRoomID]=useState(\"\");const[joined,setJoined]=useState(false);const[micOn,setMicOn]=useState(true);const[camOn,setCamOn]=useState(true);const userVideo=useRef();const peersRef=useRef([]);useEffect(()=>{if(userVideo.current&&stream){userVideo.current.srcObject=stream;}},[stream]);function createPeer(userToSignal,callerID,stream,callerName){const peer=new Peer({initiator:true,trickle:false,stream});peer.on(\"signal\",signal=>{socket.emit(\"sending signal\",{userToSignal,callerID,signal,callerName});});return peer;}function addPeer(incomingSignal,callerID,stream){const peer=new Peer({initiator:false,trickle:false,stream});peer.on(\"signal\",signal=>{socket.emit(\"returning signal\",{signal,callerID});});peer.signal(incomingSignal);return peer;}const handleJoin=async()=>{try{const userMedia=await navigator.mediaDevices.getUserMedia({video:true,audio:true});setStream(userMedia);setJoined(true);socket.emit(\"join room\",{roomID,name});socket.on(\"all users\",users=>{const peers=[];users.forEach(user=>{const peer=createPeer(user.id,socket.id,userMedia,name);peersRef.current.push({peerID:user.id,peer});peers.push({peerID:user.id,peer,name:user.name});});setPeers(peers);});socket.on(\"user joined\",payload=>{const peer=addPeer(payload.signal,payload.callerID,userMedia);peersRef.current.push({peerID:payload.callerID,peer});setPeers(users=>[...users,{peerID:payload.callerID,peer,name:payload.callerName}]);});socket.on(\"receiving returned signal\",payload=>{const item=peersRef.current.find(p=>p.peerID===payload.id);item.peer.signal(payload.signal);});}catch(err){console.error(\"Error accessing media devices.\",err);}};const toggleMic=()=>{stream.getAudioTracks()[0].enabled=!micOn;setMicOn(!micOn);};const toggleCam=()=>{stream.getVideoTracks()[0].enabled=!camOn;setCamOn(!camOn);};const leaveRoom=()=>{window.close();};return/*#__PURE__*/_jsx(\"div\",{className:\"room-container\",children:!joined?/*#__PURE__*/_jsxs(\"div\",{className:\"join-container\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"logo\",children:\"Ve Meet\"}),/*#__PURE__*/_jsx(\"input\",{placeholder:\"Enter Your Name\",onChange:e=>setName(e.target.value)}),/*#__PURE__*/_jsx(\"input\",{placeholder:\"Enter Room Code\",onChange:e=>setRoomID(e.target.value)}),/*#__PURE__*/_jsx(\"button\",{onClick:handleJoin,children:\"Join\"})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"room-panel\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"video-grid\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"video-block\",children:[/*#__PURE__*/_jsx(\"video\",{playsInline:true,muted:true,ref:userVideo,autoPlay:true,className:\"video\"}),/*#__PURE__*/_jsxs(\"p\",{children:[name,\" (You)\"]})]}),peers.map((peerObj,index)=>/*#__PURE__*/_jsx(Video,{peer:peerObj.peer,name:peerObj.name},peerObj.peerID))]}),/*#__PURE__*/_jsxs(\"div\",{className:\"controls\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:toggleMic,children:micOn?\"Mute\":\"Unmute\"}),/*#__PURE__*/_jsx(\"button\",{onClick:toggleCam,children:camOn?\"Video Off\":\"Video On\"}),/*#__PURE__*/_jsx(\"button\",{onClick:leaveRoom,children:\"Leave\"})]})]})});};const Video=_ref=>{let{peer,name}=_ref;const ref=useRef();useEffect(()=>{peer.on(\"stream\",stream=>{ref.current.srcObject=stream;});},[peer]);return/*#__PURE__*/_jsxs(\"div\",{className:\"video-block\",children:[/*#__PURE__*/_jsx(\"video\",{playsInline:true,autoPlay:true,ref:ref,className:\"video\"}),/*#__PURE__*/_jsx(\"p\",{children:name})]});};export default GuestRoom;","map":{"version":3,"names":["React","useEffect","useRef","useState","io","Peer","jsx","_jsx","jsxs","_jsxs","socket","connect","GuestRoom","stream","setStream","peers","setPeers","name","setName","roomID","setRoomID","joined","setJoined","micOn","setMicOn","camOn","setCamOn","userVideo","peersRef","current","srcObject","createPeer","userToSignal","callerID","callerName","peer","initiator","trickle","on","signal","emit","addPeer","incomingSignal","handleJoin","userMedia","navigator","mediaDevices","getUserMedia","video","audio","users","forEach","user","id","push","peerID","payload","item","find","p","err","console","error","toggleMic","getAudioTracks","enabled","toggleCam","getVideoTracks","leaveRoom","window","close","className","children","placeholder","onChange","e","target","value","onClick","playsInline","muted","ref","autoPlay","map","peerObj","index","Video","_ref"],"sources":["C:/projects/Ve Meet TEST/client/src/components/GuestRoom.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\r\nimport io from \"socket.io-client\";\r\nimport Peer from \"simple-peer\";\r\nimport './Room.css';\r\n\r\nconst socket = io.connect(\"https://192.168.29.23:5000\");\r\n\r\nconst GuestRoom = () => {\r\n  const [stream, setStream] = useState();\r\n  const [peers, setPeers] = useState([]);\r\n  const [name, setName] = useState(\"\");\r\n  const [roomID, setRoomID] = useState(\"\");\r\n  const [joined, setJoined] = useState(false);\r\n  const [micOn, setMicOn] = useState(true);\r\n  const [camOn, setCamOn] = useState(true);\r\n  const userVideo = useRef();\r\n  const peersRef = useRef([]);\r\n\r\n  useEffect(() => {\r\n    if (userVideo.current && stream) {\r\n      userVideo.current.srcObject = stream;\r\n    }\r\n  }, [stream]);\r\n\r\n  function createPeer(userToSignal, callerID, stream, callerName) {\r\n    const peer = new Peer({ initiator: true, trickle: false, stream });\r\n\r\n    peer.on(\"signal\", signal => {\r\n      socket.emit(\"sending signal\", { userToSignal, callerID, signal, callerName });\r\n    });\r\n\r\n    return peer;\r\n  }\r\n\r\n  function addPeer(incomingSignal, callerID, stream) {\r\n    const peer = new Peer({ initiator: false, trickle: false, stream });\r\n\r\n    peer.on(\"signal\", signal => {\r\n      socket.emit(\"returning signal\", { signal, callerID });\r\n    });\r\n\r\n    peer.signal(incomingSignal);\r\n    return peer;\r\n  }\r\n\r\n  const handleJoin = async () => {\r\n    try {\r\n      const userMedia = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });\r\n      setStream(userMedia);\r\n      setJoined(true);\r\n      socket.emit(\"join room\", { roomID, name });\r\n\r\n      socket.on(\"all users\", users => {\r\n        const peers = [];\r\n        users.forEach(user => {\r\n          const peer = createPeer(user.id, socket.id, userMedia, name);\r\n          peersRef.current.push({ peerID: user.id, peer });\r\n          peers.push({ peerID: user.id, peer, name: user.name });\r\n        });\r\n        setPeers(peers);\r\n      });\r\n\r\n      socket.on(\"user joined\", payload => {\r\n        const peer = addPeer(payload.signal, payload.callerID, userMedia);\r\n        peersRef.current.push({ peerID: payload.callerID, peer });\r\n        setPeers(users => [...users, { peerID: payload.callerID, peer, name: payload.callerName }]);\r\n      });\r\n\r\n      socket.on(\"receiving returned signal\", payload => {\r\n        const item = peersRef.current.find(p => p.peerID === payload.id);\r\n        item.peer.signal(payload.signal);\r\n      });\r\n    } catch (err) {\r\n      console.error(\"Error accessing media devices.\", err);\r\n    }\r\n  };\r\n\r\n  const toggleMic = () => {\r\n    stream.getAudioTracks()[0].enabled = !micOn;\r\n    setMicOn(!micOn);\r\n  };\r\n\r\n  const toggleCam = () => {\r\n    stream.getVideoTracks()[0].enabled = !camOn;\r\n    setCamOn(!camOn);\r\n  };\r\n\r\n  const leaveRoom = () => {\r\n    window.close();\r\n  };\r\n\r\n  return (\r\n    <div className=\"room-container\">\r\n      {!joined ? (\r\n        <div className=\"join-container\">\r\n          <h2 className=\"logo\">Ve Meet</h2>\r\n          <input placeholder=\"Enter Your Name\" onChange={(e) => setName(e.target.value)} />\r\n          <input placeholder=\"Enter Room Code\" onChange={(e) => setRoomID(e.target.value)} />\r\n          <button onClick={handleJoin}>Join</button>\r\n        </div>\r\n      ) : (\r\n        <div className=\"room-panel\">\r\n          <div className=\"video-grid\">\r\n            <div className=\"video-block\">\r\n              <video playsInline muted ref={userVideo} autoPlay className=\"video\" />\r\n              <p>{name} (You)</p>\r\n            </div>\r\n            {peers.map((peerObj, index) => (\r\n              <Video key={peerObj.peerID} peer={peerObj.peer} name={peerObj.name} />\r\n            ))}\r\n          </div>\r\n          <div className=\"controls\">\r\n            <button onClick={toggleMic}>{micOn ? \"Mute\" : \"Unmute\"}</button>\r\n            <button onClick={toggleCam}>{camOn ? \"Video Off\" : \"Video On\"}</button>\r\n            <button onClick={leaveRoom}>Leave</button>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nconst Video = ({ peer, name }) => {\r\n  const ref = useRef();\r\n  useEffect(() => {\r\n    peer.on(\"stream\", stream => {\r\n      ref.current.srcObject = stream;\r\n    });\r\n  }, [peer]);\r\n\r\n  return (\r\n    <div className=\"video-block\">\r\n      <video playsInline autoPlay ref={ref} className=\"video\" />\r\n      <p>{name}</p>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default GuestRoom;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}